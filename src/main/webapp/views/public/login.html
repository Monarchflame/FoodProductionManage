<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="UTF-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" name="viewport">
<meta name="theme-color" content="#4285f4">
<link rel="shortcut icon" href="../../images/labellogo.jpg" type="image/x-icon">
<title>登录</title>

<link href="../../theme/css/base.min.css" rel="stylesheet">
<link href="../../theme/css/project.min.css" rel="stylesheet">
<link href="../../theme/css/auth.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Material+Icons" rel="stylesheet">

<!--重新请求，生成一个新的验证码，因为浏览器会缓存图片，所以要随便加一个参数，让浏览器重新请求服务器-->
<script type="text/javascript">
function _change() {
	/*
	1. 得到img元素
	2. 修改其src为/day11_3/VerifyCodeServlet
	*/
	var imgEle = document.getElementById("img");
	imgEle.src = "/MyWeb/VerifyCodeServlet?a=" + new Date().getTime();
}
</script>

</head>
<body class="page-brand">
    <div class="authpage">
        <div class="container">
            <section>
                <div class="auth-main auth-row auth-col-one">
                    <div class="auth-top auth-row">
                        <a class="boardtop-left" href="/MyWeb/home/html/home.html">
                            <div>首 页</div>
                        </a>
                        <div class="auth-logo">
                            <img src="../../images/authlogo.jpg">
                        </div>
                        <a href="register.html" class="boardtop-right">
                            <div>注 册</div>
                        </a>
                    </div>
                    <div class="auth-row">
                        <div class="form-group-label auth-row row-login">
                            <label class="floating-label" for="email">邮箱</label>
                            <input class="form-control maxwidth-auth" id="email" type="text" name="email">
                        </div>
                    </div>
                    <div class="auth-row">
                        <div class="form-group-label auth-row row-login">
                            <label class="floating-label" for="passwd">密码</label>
                            <input class="form-control maxwidth-auth" id="passwd" type="password" name="passwd">
                        </div>
                    </div>
                    <div class="auth-row">
                        <!--下面这个div有一个类选择器，因为它不太一样，类选择器优先级高，我自己设置了一下-->
                        <div class="form-group-label auth-row row-login" id="code-row">
                            <label class="floating-label" for="code">验证码</label>
                            <input class="form-control maxwidth-auth code" id="code" type="text" name="code">
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <img id="img" name="img" src="/MyWeb/VerifyCodeServlet" onclick="javascript:_change()">
                        </div>
                    </div>
                    <div class="btn-auth auth-row">
                        <button id="login" type="submit" class="btn btn-block btn-brand waves-attach waves-light">
                            确认登录
                        </button>
                    </div>
                    <div class="auth-help auth-row">
                    <div class="auth-help-table auth-row">
                    <div class="checkbox checkbox-adv">
                    <label for="remember_me">
                    <input class="access-hide" value="week" id="remember_me" name="remember_me" type="checkbox">记住我
                    <span class="checkbox-circle"></span>
                    <span class="checkbox-circle-check"></span>
                    <span class="checkbox-circle-icon icon">done</span>
                    </label>
                    </div>
                    <a href="reset.html">忘记密码？</a>
                    </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <div aria-hidden="true" class="modal modal-va-middle fade" id="result" role="dialog" tabindex="-1">
    <div class="modal-dialog modal-xs">
    <div class="modal-content">
    <div class="modal-inner">
        <p class="h5 margin-top-sm text-black-hint" id="msg"></p>
    </div>
    <div class="modal-footer">
        <p class="text-right">
            <button class="btn btn-flat btn-brand-accent waves-attach" data-dismiss="modal" type="button" id="result_ok">知道了
            </button>
        </p>
    </div>
    </div>
    </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.1" type="text/javascript"></script>
    <script src="../../theme/js/base.min.js" type="text/javascript"></script>
    <script src="../../theme/js/project.min.js" type="4text/javascript"></script>
    <script src="https://ajax.cloudflare.com/cdn-cgi/scripts/95c75768/cloudflare-static/rocket-loader.min.js" data-cf-settings="439ccd34d75bad8383a7ab79-|49" defer=""></script>
</body>
</html>

<!--自动点击一次验证码-->
<script>
    document.getElementById("img").click();
</script>

<!--登录-->
<script type="text/javascript">
    $(document).ready(function () {
        function login() {
            document.getElementById("login").disabled = true;

            $.ajax({
                type: "POST",
                url: "/MyWeb/LoginServlet",
                dataType: "json",
                data: {
                    email: $("#email").val(),
                    passwd: $("#passwd").val(),
                    code: $("#code").val(),
                    remember_me: $("#remember_me:checked").val()
                },
                success: (data) => {

                    if (data.ret == 1) //成功
                    {
                        $("#result").modal();
                        document.getElementById("msg").innerHTML = data.msg;
                        document.getElementById("code").value = "";
                        window.setTimeout("javascript:location.href='../staff/staff.html'", 1000);
                        //window.location.href='user.html';

                    } else {
                    	//alert(data.ret);
                    	//alert(data.ret == 1);
                        $("#result").modal();
                        document.getElementById("msg").innerHTML = data.msg;
                        document.getElementById("login").disabled = false;
                        document.getElementById("code").value = "";
                        document.getElementById("img").click();
                    }
                },
                error: (jqXHR) => {
                    document.getElementById("msg").innerHTML = `发生错误：${
                        jqXHR.status
                    }`;
                    document.getElementById("login").disabled = false;
                }
            });
        }

        $("html").keydown(function (event) {
            if (event.keyCode == 13) {
                login();
            }
        });
        $("#login").click(function () {
            login();
        });

        $('div.modal').on('shown.bs.modal', function () {
            $("div.gt_slider_knob").hide();
        });

        $('div.modal').on('hidden.bs.modal', function () {
            $("div.gt_slider_knob").show();
        });
    })
</script>
<script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs@gh-pages/qrcode.min.js" type="b779432ce0c80423a240ab69-text/javascript"></script>